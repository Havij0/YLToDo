<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Todo App</title>
<style>
body { margin:0; font-family:-apple-system,BlinkMacSystemFont,sans-serif; background:#f2f2f7; }
.hidden { display:none; }

header { padding:14px 16px; font-size:18px; font-weight:600; background:#fff; border-bottom:1px solid #ddd; display:flex; align-items:center; justify-content:space-between; }
header button { font-size:16px; padding:6px 12px; border:none; background:none; cursor:pointer; }

#tasks { padding:12px; padding-bottom:120px; }
.task { background:#fff; border-radius:16px; margin-bottom:12px; overflow:hidden; position:relative; touch-action: pan-y; transition: transform 0.2s ease, opacity 0.2s; }
.task.done { opacity:0.5; }

.task-row { display:flex; align-items:center; min-height:48px; padding:0 12px; background:#fff; position:relative; z-index:2; }
.task-left { width:44px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
.task-middle { flex:1; min-width:0; margin:0 8px; display:flex; align-items:center; justify-content:space-between; }
.task-right { display:flex; align-items:center; gap:6px; flex-shrink:0; }
.task-row input[type="checkbox"] { width:22px; height:22px; margin:0; }
.task-title { font-size:16px; font-weight:600; cursor:pointer; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.dot { width:12px; height:12px; border-radius:50%; }
.chevron { font-size:16px; cursor:pointer; transition:transform 0.2s; }

.swipe-bg { position:absolute; inset:0; border-radius:16px; display:flex; justify-content:flex-end; align-items:center; padding:0 8px; z-index:1; pointer-events:none; }
.swipe-btn { width:44px; height:44px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-left:8px; color:#fff; font-size:18px; pointer-events:auto; }

#addBar { position:fixed; bottom:0; left:0; right:0; background:#fff; padding:12px; display:flex; gap:8px; border-top:1px solid #ddd; }
#addBar input, #addBar select { font-size:16px; padding:14px; border-radius:14px; border:1px solid #ccc; }
#addBar button { padding:14px 18px; font-size:20px; border-radius:14px; border:none; background:#000; color:#fff; }

</style>
</head>
<body>

<div id="today">
  <header><span>Today</span></header>
  <div id="tasks"></div>
  <div id="addBar">
    <input id="newTitle" placeholder="New taskâ€¦">
    <select id="newPriority">
      <option value="3">Normal</option>
      <option value="2">Important</option>
      <option value="1">Must</option>
    </select>
    <button onclick="addTask()">+</button>
  </div>
</div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks")||"[]");

// --- UTIL ---
function save(){ localStorage.setItem("tasks",JSON.stringify(tasks)); }

// --- TASK CRUD ---
function addTask(){
  const title=newTitle.value.trim(); if(!title) return;
  const now=Date.now();
  tasks.push({id:now,title,priority:Number(newPriority.value),done:false,subtasks:[],expanded:false});
  newTitle.value=""; save(); render();
}

// --- SWIPE & TASK RENDER ---
function attachSwipe(taskRow,task){
  let startX=0,currentX=0,moving=false;
  const threshold=50; 
  taskRow.querySelectorAll(".swipe-bg").forEach(el=>el.remove());
  const bg=document.createElement("div"); bg.className="swipe-bg"; taskRow.prepend(bg);

  const createBtn=(icon,bgColor,action)=>{
    const btn=document.createElement("div"); btn.className="swipe-btn"; btn.textContent=icon;
    btn.style.background=bgColor; btn.onclick=e=>{e.stopPropagation();action();}; bg.append(btn); return btn;
  };

  const editBtn=createBtn("âœï¸","#007AFF",()=>alert("Edit Task")); 
  const rescheduleBtn=createBtn("ðŸ“…","#FF9500",()=>alert("Reschedule Task"));
  const deleteBtn=createBtn("ðŸ—‘ï¸","#FF3B30",()=>{ tasks=tasks.filter(t=>t.id!==task.id); save(); render(); });

  // TOUCH SWIPE
  taskRow.addEventListener("touchstart",e=>{startX=e.touches[0].clientX;moving=true;});
  taskRow.addEventListener("touchmove",e=>{
    if(!moving) return;
    currentX=e.touches[0].clientX;
    const deltaX=currentX-startX;
    if(deltaX>0) taskRow.style.transform=`translateX(${Math.min(deltaX,80)}px)`;
    else taskRow.style.transform=`translateX(${Math.max(deltaX,-120)}px)`;
  });
  taskRow.addEventListener("touchend",e=>{
    moving=false; 
    const deltaX=currentX-startX;
    if(deltaX>threshold){ task.done=!task.done; save(); render(); }
    taskRow.style.transform="";
  });
}

function render(){
  tasks.sort((a,b)=>a.done-b.done);
  const tasksDiv=document.getElementById("tasks"); tasksDiv.innerHTML="";
  tasks.forEach(task=>{
    const card=document.createElement("div"); card.className="task"+(task.done?" done":"");
    const row=document.createElement("div"); row.className="task-row";

    const left=document.createElement("div"); left.className="task-left";
    const middle=document.createElement("div"); middle.className="task-middle";
    const right=document.createElement("div"); right.className="task-right";

    // Checkbox
    const c=document.createElement("input"); c.type="checkbox"; c.checked=task.done;
    c.onchange=e=>{ task.done=c.checked; save(); render(); e.stopPropagation(); };
    left.append(c);

    // Title
    const title=document.createElement("div"); title.className="task-title"; title.textContent=task.title;
    middle.append(title);

    // Priority dot
    const dot=document.createElement("div"); dot.className="dot";
    dot.style.background=task.priority===1?"#ff3b30":task.priority===2?"#ff9500":"#ffcc00";
    right.append(dot);

    row.append(left,middle,right); card.append(row); tasksDiv.append(card);

    attachSwipe(row,task);
  });
}

render();
</script>
</body>
</html>
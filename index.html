<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>To-Do App - Full Version</title>
<style>
html, body { margin:0; padding:0; height:100%; font-family:-apple-system,BlinkMacSystemFont,sans-serif; background:#f2f2f7; }
body { display:flex; flex-direction:column; }

header { padding:16px; font-size:20px; font-weight:600; background:#fff; border-bottom:1px solid #e5e5ea; }

.tasks-wrapper { flex:1; overflow:hidden; }
#tasks { height:100%; overflow-y:auto; padding:12px; overscroll-behavior:contain; }

.task { margin-bottom:10px; }
.task-row { position:relative; height:64px; background:#fff; border-radius:12px; overflow:hidden; display:flex; align-items:center; padding:0 16px; }
.task-row input[type="checkbox"] { width:22px; height:22px; margin-right:12px; }
.task-title { flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-size:16px; }
.priority { width:14px; height:14px; border-radius:50%; background:#ffcc00; }

.add-bar { flex-shrink:0; height:64px; display:flex; align-items:center; gap:8px; padding:0 12px; background:#fff; border-top:1px solid #e5e5ea; }
.add-bar input { flex:1; height:40px; border-radius:10px; border:1px solid #ccc; padding:0 12px; font-size:16px; }
.add-bar button { width:44px; height:44px; border-radius:12px; border:none; font-size:22px; background:#000; color:#fff; cursor:pointer; }

/* TASK PAGE */
#taskPage { position:fixed; top:0; left:0; right:0; bottom:0; background:#f2f2f7; display:none; flex-direction:column; z-index:100; }
#taskPage header { display:flex; justify-content:space-between; align-items:center; padding:16px; font-size:20px; background:#fff; border-bottom:1px solid #e5e5ea; }
#taskPage .content { flex:1; padding:16px; overflow-y:auto; display:flex; flex-direction:column; gap:12px; }
#taskPage .title-edit { font-size:20px; padding:6px 8px; border:1px solid #ccc; border-radius:8px; display:none; }
#taskPage .description-edit { font-size:16px; padding:6px 8px; border:1px solid #ccc; border-radius:8px; display:none; min-height:60px; }
#taskPage .title-view { font-size:20px; font-weight:600; }
#taskPage .description-view { font-size:16px; color:#555; min-height:60px; }
.subtasks { display:flex; flex-direction:column; gap:8px; margin-top:8px; }
.subtask-row { display:flex; gap:8px; align-items:center; }
.subtask-row input { flex:1; height:36px; border-radius:6px; border:1px solid #ccc; padding:0 8px; font-size:16px; }
.subtask-row button { width:32px; height:32px; border:none; border-radius:6px; background:#FF3B30; color:white; font-size:18px; cursor:pointer; display:none; }
#taskPage .timestamps { font-size:12px; color:#555; margin-top:4px; }
#taskPage #editToggleBtn { padding:6px 12px; background:#007AFF; color:white; border:none; border-radius:8px; cursor:pointer; }
#taskPage #deleteTaskBtn { padding:6px 12px; background:#FF3B30; color:white; border:none; border-radius:8px; width:100%; margin-top:8px; display:none; }
#taskPage #subtaskInput { width:100%; min-height:60px; border:1px solid #ccc; border-radius:8px; padding:8px; font-size:16px; display:none; resize:none; }
#taskPage #addSubtaskBtn { padding:6px 12px; background:#007AFF; color:white; border:none; border-radius:8px; cursor:pointer; display:none; width:100%; }
</style>
</head>
<body>

<header>Today</header>

<div class="tasks-wrapper">
  <div id="tasks"></div>
</div>

<div class="add-bar">
  <input id="newTask" placeholder="Add a task…" autocorrect="off" autocomplete="off">
  <button onclick="addTask()">+</button>
</div>

<!-- TASK PAGE -->
<div id="taskPage">
  <header>
    <button id="backBtn">&larr;</button>
    <span>Task</span>
    <button id="editToggleBtn">Edit</button>
  </header>
  <div class="content">
    <input id="taskTitleEdit" class="title-edit" autocorrect="off" autocomplete="off">
    <div id="taskTitleView" class="title-view"></div>
    <textarea id="taskDescriptionEdit" class="description-edit" placeholder="Add a description"></textarea>
    <div id="taskDescriptionView" class="description-view"></div>

    <textarea id="subtaskInput" placeholder="Write subtasks, one per line"></textarea>
    <button id="addSubtaskBtn">Add Subtasks</button>

    <div class="subtasks" id="taskSubtasks"></div>
    <div class="timestamps" id="taskTimestamps"></div>
    <button id="deleteTaskBtn">Delete Task</button>
  </div>
</div>

<script>
let tasks = [
  {id:1,title:"Buy groceries",description:"Milk, Eggs, Bread",subtasks:[{title:"Buy milk",done:false}],created:Date.now(),updated:Date.now()},
  {id:2,title:"Finish project presentation",description:"Prepare slides",subtasks:[],created:Date.now(),updated:Date.now()},
  {id:3,title:"Go to the gym",description:"Leg day",subtasks:[],created:Date.now(),updated:Date.now()}
];

let currentTask=null;
let editMode=false;

function render(){
  const list=document.getElementById("tasks");
  list.innerHTML="";
  tasks.forEach(task=>{
    const row=document.createElement("div"); row.className="task-row";
    row.innerHTML=`<input type="checkbox"${task.done?' checked':''}><div class="task-title">${task.title}</div><div class="priority"></div>`;
    list.appendChild(row);
    row.addEventListener("click",()=>{ openTaskPage(task); });
  });
}

function addTask(){
  const input=document.getElementById("newTask");
  const title=input.value.trim(); if(!title) return;
  tasks.push({id:Date.now(),title,description:"",subtasks:[],created:Date.now(),updated:Date.now()});
  input.value=""; render();
}

/* TASK PAGE ELEMENTS */
const taskPage=document.getElementById("taskPage");
const backBtn=document.getElementById("backBtn");
const editToggleBtn=document.getElementById("editToggleBtn");
const taskTitleEdit=document.getElementById("taskTitleEdit");
const taskTitleView=document.getElementById("taskTitleView");
const taskDescriptionEdit=document.getElementById("taskDescriptionEdit");
const taskDescriptionView=document.getElementById("taskDescriptionView");
const subtaskInput=document.getElementById("subtaskInput");
const addSubtaskBtn=document.getElementById("addSubtaskBtn");
const taskSubtasks=document.getElementById("taskSubtasks");
const taskTimestamps=document.getElementById("taskTimestamps");
const deleteTaskBtn=document.getElementById("deleteTaskBtn");

function openTaskPage(task){
  currentTask=task;
  editMode=false;
  renderTaskPage();
  taskPage.style.display="flex";
}

function renderTaskPage(){
  if(!currentTask) return;

  // Title & description
  taskTitleView.style.display=editMode?"none":"block";
  taskTitleEdit.style.display=editMode?"block":"none";
  taskTitleView.textContent=currentTask.title;
  taskTitleEdit.value=currentTask.title;

  taskDescriptionView.style.display=editMode?"none":"block";
  taskDescriptionEdit.style.display=editMode?"block":"none";
  taskDescriptionView.textContent=currentTask.description;
  taskDescriptionEdit.value=currentTask.description;

  // Subtasks
  taskSubtasks.innerHTML="";
  currentTask.subtasks.forEach((st,i)=>{
    const row=document.createElement("div"); row.className="subtask-row";
    const checkbox=document.createElement("input"); checkbox.type="checkbox"; checkbox.checked=st.done;
    checkbox.addEventListener("change",()=>{ st.done=checkbox.checked; currentTask.updated=Date.now(); renderTaskPage(); });
    const label=document.createElement("input"); label.value=st.title; label.disabled=!editMode;
    label.addEventListener("input",()=>{ st.title=label.value; currentTask.updated=Date.now(); });
    const delBtn=document.createElement("button"); delBtn.textContent="×"; delBtn.style.display=editMode?"block":"none";
    delBtn.addEventListener("click",()=>{ currentTask.subtasks.splice(i,1); currentTask.updated=Date.now(); renderTaskPage(); });
    row.append(checkbox,label,delBtn); taskSubtasks.append(row);
  });

  subtaskInput.style.display=editMode?"block":"none";
  addSubtaskBtn.style.display=editMode?"block":"none";
  if(editMode){ addSubtaskBtn.style.display="block"; }

  const created=new Date(currentTask.created).toLocaleString();
  const updated=new Date(currentTask.updated).toLocaleString();
  taskTimestamps.textContent=`Created: ${created} | Last edit: ${updated}`;

  editToggleBtn.textContent=editMode?"Save":"Edit";
  deleteTaskBtn.style.display=editMode?"block":"none";
}

editToggleBtn.addEventListener("click",()=>{
  if(editMode){
    currentTask.title=taskTitleEdit.value;
    currentTask.description=taskDescriptionEdit.value;
    currentTask.updated=Date.now();
    editMode=false;
  } else { editMode=true; }
  renderTaskPage(); render();
});

addSubtaskBtn.addEventListener("click",()=>{
  const lines=subtaskInput.value.split("\n").map(l=>l.trim()).filter(l=>l);
  lines.forEach(l=>currentTask.subtasks.push({title:l,done:false}));
  subtaskInput.value="";
  currentTask.updated=Date.now();
  renderTaskPage();
});

deleteTaskBtn.addEventListener("click",()=>{
  tasks=tasks.filter(t=>t.id!==currentTask.id);
  currentTask=null; taskPage.style.display="none"; render();
});

backBtn.addEventListener("click",()=>{taskPage.style.display="none";});

render();
</script>

</body>
</html>
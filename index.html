<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTFâ€‘8" />
<meta name="viewport" content="width=deviceâ€‘width, initialâ€‘scale=1, maximumâ€‘scale=1, userâ€‘scalable=no" />
<title>Todo App â€“ v0.8.5</title>

<style>
* { boxâ€‘sizing: borderâ€‘box; }
body { margin:0; fontâ€‘family: -appleâ€‘system, BlinkMacSystemFont, "SF Pro Text", sansâ€‘serif; background:#f2f2f7; }

/* HEADER */
header {
  position:fixed; top:0; left:0; right:0;
  height:56px; background:#fff; borderâ€‘bottom:1px solid #ddd;
  display:flex; alignâ€‘items:center; justifyâ€‘content:spaceâ€‘between;
  padding:0 16px; zâ€‘index:20;
}
header .title { font-size:20px; fontâ€‘weight:700; }
header .version { font-size:12px; color:#888; }

/* CONTENT */
#content { paddingâ€‘top:72px; paddingâ€‘bottom:120px; }

/* TASK CARD */
.task { background:#fff; margin:10px 12px; borderâ€‘radius:16px; overflow:hidden; position:relative; }
.task.done { opacity:0.45; }

.task-row {
  display:flex; alignâ€‘items:center;
  minâ€‘height:52px; padding:0 14px;
  background:#fff; position:relative;
  zâ€‘index:2;
  transition:transform 0.25s ease, opacity 0.25s ease;
  touchâ€‘action: panâ€‘y;
}

.taskâ€‘left { width:36px; }
.taskâ€‘middle { flex:1; minâ€‘width:0; }
.taskâ€‘right { width:20px; }

.taskâ€‘title {
  fontâ€‘size:16px; fontâ€‘weight:600;
  whiteâ€‘space:nowrap; overflow:hidden; textâ€‘overflow:ellipsis;
  cursor:pointer;
}

.dot { width:10px; height:10px; borderâ€‘radius:50%; }

/* SWIPE ACTIONS */
.swipe-bg {
  position:absolute; inset:0;
  display:flex; justifyâ€‘content:flexâ€‘end; alignâ€‘items:center;
  paddingâ€‘right:10px; background:#f2f2f7; zâ€‘index:1;
}
.swipe-btn {
  width:44px; height:44px; borderâ€‘radius:14px;
  display:flex; alignâ€‘items:center; justifyâ€‘content:center;
  marginâ€‘left:8px; color:#fff; fontâ€‘size:18px;
}

/* ADD BAR */
#addBar {
  position:fixed; bottom:0; left:0; right:0;
  background:#fff; borderâ€‘top:1px solid #ddd;
  padding:10px 12px; display:flex; gap:8px;
  zâ€‘index:20;
}
#addBar input, #addBar select {
  flex:1; fontâ€‘size:16px; padding:12px; border:1px solid #ccc; borderâ€‘radius:14px;
}
#addBar button {
  padding:0 18px; fontâ€‘size:22px; border:none;
  borderâ€‘radius:14px; background:#000; color:#fff; cursor:pointer;
}

/* DETAILS */
#details {
  position:fixed; inset:0; background:#f2f2f7;
  zâ€‘index:50; overflowâ€‘y:auto; touchâ€‘action:none;
}
#details .spacer { height:72px; }

.section {
  background:#fff; margin:12px; padding:16px; borderâ€‘radius:16px;
}
.section h3 { margin:0 0 8px; fontâ€‘size:13px; color:#666; }
.read { fontâ€‘size:16px; }

input, textarea, select {
  width:100%; fontâ€‘size:16px; padding:12px;
  border:1px solid #ccc; borderâ€‘radius:12px;
}
textarea { resize:none; }

.subtask {
  display:flex; alignâ€‘items:center; gap:8px; marginâ€‘bottom:8px;
}
.subtask input { width:20px; height:20px; }
.subtask .text { flex:1; }

#deleteBtn {
  margin:16px 12px; padding:14px;
  fontâ€‘size:16px; border:none; borderâ€‘radius:16px;
  background:#ff3b30; color:#fff; cursor:pointer;
}

.timestamps {
  margin:0 12px 24px; fontâ€‘size:12px; color:#888;
}

/* ADVANCED ADD PULLâ€‘UP */
#advAddTask {
  position:fixed; left:0; right:0; bottom:0;
  maxâ€‘height:90%; overflowâ€‘y:auto;
  background:#fff; borderâ€‘topâ€‘leftâ€‘radius:20px; borderâ€‘topâ€‘rightâ€‘radius:20px;
  boxâ€‘shadow: 0 â€‘3px 10px rgba(0,0,0,0.15);
  transform:translateY(100%);
  transition:transform 0.3s ease;
  zâ€‘index:30; padding:16px;
}
#advAddTask .handle {
  width:40px; height:4px; background:#ccc;
  borderâ€‘radius:2px; margin:0 auto 12px;
}
</style>
</head>

<body>

<header>
  <div class="title">Today</div>
  <div class="version">v0.8.5</div>
</header>

<div id="content"><div id="tasks"></div></div>

<div id="addBar">
  <input id="newTitle" placeholder="New taskâ€¦" />
  <select id="newPriority">
    <option value="3">Normal</option>
    <option value="2">Important</option>
    <option value="1">Must</option>
  </select>
  <button onclick="addTask()">+</button>
  <button onclick="openAdvancedAdd()">â‹</button>
</div>

<!-- ADVANCED ADD TASK -->
<div id="advAddTask">
  <div class="handle"></div>
  <h3>Advanced Add Task</h3>

  <div class="section">
    <input id="advTitle" placeholder="Title" />
  </div>
  <div class="section">
    <textarea id="advDesc" rows="3" placeholder="Description"></textarea>
  </div>
  <div class="section">
    <select id="advPriority">
      <option value="3">Normal</option>
      <option value="2">Important</option>
      <option value="1">Must</option>
    </select>
  </div>
  <div class="section">
    <textarea id="advSubtasks" rows="3" placeholder="Subtasks (one per line)"></textarea>
  </div>

  <button onclick="addAdvancedTask()">Add Task</button>
  <button onclick="closeAdvancedAdd()">Cancel</button>
</div>

<!-- DETAILS -->
<div id="details" class="hidden">
  <header>
    <button onclick="closeDetails()">â† Back</button>
    <button id="editBtn" onclick="toggleEdit()">Edit</button>
  </header>
  <div class="spacer"></div>

  <div class="section">
    <h3>Title</h3>
    <div id="vTitle" class="read"></div>
    <input id="eTitle" class="hidden">
  </div>

  <div class="section hidden" id="secDesc">
    <h3>Description</h3>
    <div id="vDesc" class="read"></div>
    <textarea id="eDesc" class="hidden" rows="4"></textarea>
  </div>

  <div class="section hidden" id="secSubs">
    <h3>Subtasks</h3>
    <div id="subtasks"></div>
    <textarea id="subInput" class="hidden" placeholder="One subtask per line"></textarea>
    <button id="addSubBtn" class="hidden" onclick="addSubtasks()">+ Add subtasks</button>
  </div>

  <button id="deleteBtn" class="hidden" onclick="deleteTask()">Delete task</button>
  <div class="timestamps" id="timestamps"></div>
</div>

<script>
/* STATE */
const newTitle = document.getElementById("newTitle");
const newPriority = document.getElementById("newPriority");
const tasksDiv = document.getElementById("tasks");

const adv = document.getElementById("advAddTask");
const advTitle = document.getElementById("advTitle");
const advDesc = document.getElementById("advDesc");
const advPriority = document.getElementById("advPriority");
const advSubtasks = document.getElementById("advSubtasks");

const details = document.getElementById("details");
const vTitle = document.getElementById("vTitle");
const vDesc = document.getElementById("vDesc");
const eTitle = document.getElementById("eTitle");
const eDesc = document.getElementById("eDesc");
const secDesc = document.getElementById("secDesc");
const secSubs = document.getElementById("secSubs");
const subtasks = document.getElementById("subtasks");
const subInput = document.getElementById("subInput");
const addSubBtn = document.getElementById("addSubBtn");
const deleteBtn = document.getElementById("deleteBtn");
const editBtn = document.getElementById("editBtn");
const timestamps = document.getElementById("timestamps");

let tasks = JSON.parse(localStorage.getItem("tasks_v085") || "[]");
let active = null;
let editMode = false;
const SWIPE_WIDTH = 160;

/* SAVE */
function save(){ localStorage.setItem("tasks_v085", JSON.stringify(tasks)); }

/* QUICK ADD */
function addTask(){
  const t=newTitle.value.trim(); if(!t) return;
  const now=Date.now();
  tasks.push({ id:now, title:t, desc:"", priority:+newPriority.value, done:false, subtasks:[], created:now, edited:now });
  newTitle.value=""; save(); render();
}

/* ADVANCED ADD */
function openAdvancedAdd(){ adv.style.transform="translateY(0)"; }
function closeAdvancedAdd(){ adv.style.transform="translateY(100%)"; }

function addAdvancedTask(){
  const t=advTitle.value.trim(); if(!t){ alert("Title required"); return; }
  const now=Date.now();
  const subs = advSubtasks.value.split("\n").filter(Boolean).map(s=>({title:s,done:false}));
  tasks.push({ id:now, title:t, desc:advDesc.value.trim(), priority:+advPriority.value, done:false, subtasks:subs, created:now, edited:now });
  advTitle.value=""; advDesc.value=""; advSubtasks.value=""; advPriority.value="3";
  save(); render(); closeAdvancedAdd();
}

/* RENDER */
function render(){
  tasksDiv.innerHTML="";
  tasks.forEach(task=>{
    const card=document.createElement("div");
    card.className="task"+(task.done?" done":"");
    const bg=document.createElement("div"); bg.className="swipe-bg";
    bg.append(
      swipeBtn("âœï¸","#007aff",()=>openDetails(task.id)),
      swipeBtn("ğŸ“…","#ff9500",()=>alert("Schedule later")),
      swipeBtn("ğŸ—‘","#ff3b30",()=>{ tasks=tasks.filter(t=>t.id!==task.id); save(); render(); })
    );

    const row=document.createElement("div"); row.className="task-row";
    let startX=0, dx=0;
    row.addEventListener("touchstart",e=>startX=e.touches[0].clientX);
    row.addEventListener("touchmove",e=>{ dx=e.touches[0].clientX-startX; if(dx<0) row.style.transform=`translateX(${dx}px)`; });
    row.addEventListener("touchend",()=>{ if(dx<â€‘80) row.style.transform=`translateX(-${SWIPE_WIDTH}px)`; else row.style.transform="translateX(0)"; dx=0; });

    const left=document.createElement("div"); left.className="task-left";
    const cb=document.createElement("input"); cb.type="checkbox"; cb.checked=task.done;
    cb.onchange=e=>{ task.done=cb.checked; save(); render(); e.stopPropagation(); };
    left.append(cb);

    const mid=document.createElement("div"); mid.className="task-middle";
    const title=document.createElement("div"); title.className="task-title"; title.textContent=task.title;
    title.onclick=()=>openDetails(task.id);
    mid.append(title);

    const right=document.createElement("div"); right.className="task-right";
    const dot=document.createElement("div"); dot.className="dot";
    dot.style.background = task.priority===1?"#ff3b30":task.priority===2?"#ff9500":"#34c759";
    right.append(dot);

    row.append(left,mid,right); card.append(bg,row); tasksDiv.append(card);
  });
}

/* DETAILS */
function openDetails(id){ active=tasks.find(t=>t.id===id); editMode=false; renderDetails(); details.classList.remove("hidden"); }
function closeDetails(){ save(); render(); details.classList.add("hidden"); }

/* SWIPEâ€‘RIGHT TO CLOSE DETAILS */
let dStart=0, dDx=0;
details.addEventListener("touchstart",e=>dStart=e.touches[0].clientX);
details.addEventListener("touchmove",e=>dDx=e.touches[0].clientX-dStart);
details.addEventListener("touchend",()=>{ if(dDx>100) closeDetails(); dDx=0; });

function toggleEdit(){ if(editMode){ active.title=eTitle.value.trim(); active.desc=eDesc.value.trim(); active.edited=Date.now(); save(); } editMode=!editMode; editBtn.textContent=editMode?"Done":"Edit"; renderDetails(); }
function deleteTask(){ tasks=tasks.filter(t=>t.id!==active.id); save(); closeDetails(); }
function renderDetails(){
  vTitle.textContent=active.title; vDesc.textContent=active.desc;
  eTitle.value=active.title; eDesc.value=active.desc;
  secDesc.classList.toggle("hidden",!editMode && !active.desc);
  secSubs.classList.toggle("hidden",!editMode && active.subtasks.length===0);
  [vTitle,vDesc].forEach(e=>e.classList.toggle("hidden",editMode));
  [eTitle,eDesc,subInput,addSubBtn,deleteBtn].forEach(e=>e.classList.toggle("hidden",!editMode));
  subtasks.innerHTML="";
  active.subtasks.forEach(s=>{ const r=document.createElement("div"); r.className="subtask"; r.innerHTML=`<input type="checkbox" ${s.done?"checked":""}><div class="text">${s.title}</div>`; subtasks.append(r); });
  timestamps.textContent=`Created: ${new Date(active.created).toLocaleString()} Â· Edited: ${new Date(active.edited).toLocaleString()}`;
}

function addSubtasks(){ active.desc=eDesc.value.trim(); active.edited=Date.now(); subInput.value.split("\n").filter(Boolean).forEach(t=>active.subtasks.push({title:t,done:false})); subInput.value=""; save(); renderDetails(); }

function swipeBtn(icon,color,fn){ const b=document.createElement("div"); b.className="swipe-btn"; b.textContent=icon; b.style.background=color; b.onclick=e=>{e.stopPropagation();fn();}; return b; }

render();
</script>
</body>
</html>
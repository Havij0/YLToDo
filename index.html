<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Todo App</title>
<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f2f2f7;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

header {
  padding: 14px 16px;
  font-size: 18px;
  font-weight: 600;
  background: #fff;
  border-bottom: 1px solid #ddd;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0;
}

#tasks-container {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
  padding-bottom: 100px; /* enough for Add Task bar */
}

.task {
  position: relative;
  margin-bottom: 12px;
  border-radius: 16px;
  overflow: hidden;
  background: #fff;
}

/* Swipe background buttons */
.swipe-bg {
  position: absolute;
  top:0; bottom:0; right:0;
  display: flex;
  justify-content:flex-end;
  align-items:center;
  gap:8px;
  padding-right:8px;
  border-radius:16px;
  z-index:1; /* behind row */
}

.swipe-btn {
  width:44px; height:44px;
  display:flex; align-items:center; justify-content:center;
  border-radius:12px;
  color:#fff;
  font-size:18px;
  flex-shrink:0;
}

/* Row content */
.task-row {
  display:flex;
  align-items:center;
  min-height:48px;
  padding:0 12px;
  position:relative;
  z-index:2; /* above buttons */
  background:#fff;
  transition: transform 0.2s ease, opacity 0.2s ease;
}

.task-left { width:44px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
.task-middle { flex:1; min-width:0; margin:0 8px; }
.task-right { width:28px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }

.task-row input[type="checkbox"] { width:22px; height:22px; margin:0; }
.task-title { font-size:16px; font-weight:600; cursor:pointer; }

/* Improved priority dots/logos */
.dot {
  width:16px;
  height:16px;
  border-radius:50%;
  border:1px solid #ccc;
  box-shadow: 0 1px 2px rgba(0,0,0,0.15);
}

/* Add Task Bar */
#addBar {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: #fff; padding: 12px; display: flex; gap: 8px; border-top: 1px solid #ddd;
  z-index: 10;
}

#addBar input, #addBar select { font-size:16px; padding:14px; border-radius:14px; border:1px solid #ccc; }
#addBar button { padding:14px 18px; font-size:20px; border-radius:14px; border:none; background:#000; color:#fff; }

/* Delete button design */
#deleteTaskBtn {
  width: calc(100% - 24px);
  margin: 12px auto;
  padding:12px;
  font-size:16px;
  border-radius:14px;
  border:none;
  background:#ff3b30;
  color:#fff;
  display:block;
}

/* Details screen */
#details {
  position: fixed; inset:0; background:#f2f2f7; z-index:50; overflow-y:auto; display:none;
}

.section { background:#fff; margin:12px; padding:16px; border-radius:16px; }
.section h3 { margin:0 0 8px 0; font-size:13px; color:#666; }
.read-text { font-size:16px; line-height:1.4; min-height:24px; cursor:pointer; }

</style>
</head>
<body>

<header><span>Today</span></header>

<div id="tasks-container">
  <div id="tasks"></div>
</div>

<div id="addBar">
  <input id="newTitle" placeholder="New task‚Ä¶">
  <select id="newPriority">
    <option value="3">Normal</option>
    <option value="2">Important</option>
    <option value="1">Must</option>
  </select>
  <button onclick="addTask()">+</button>
</div>

<div id="details">
  <header>
    <button onclick="closeDetails()">‚Üê Back</button>
  </header>
  <div class="section">
    <h3>Title</h3>
    <div id="vTitle" class="read-text"></div>
  </div>
  <div class="section">
    <h3>Description</h3>
    <div id="vDesc" class="read-text"></div>
  </div>
  <div class="section">
    <h3>Priority</h3>
    <div id="vPriority" class="read-text"></div>
  </div>
  <button id="deleteTaskBtn" onclick="deleteTask()">Delete Task</button>
</div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks")||"[]");
let activeTask=null;

function save(){ localStorage.setItem("tasks", JSON.stringify(tasks)); }

function addTask(){
  const title = newTitle.value.trim(); if(!title) return;
  tasks.push({id:Date.now(),title,priority:Number(newPriority.value),done:false});
  newTitle.value=""; save(); render();
}

function openDetails(id){
  activeTask = tasks.find(t=>t.id===id);
  vTitle.textContent = activeTask.title;
  vDesc.textContent = activeTask.desc||"No description";
  vPriority.textContent = activeTask.priority===1?"Must":activeTask.priority===2?"Important":"Normal";
  details.style.display="block";
  document.getElementById("tasks-container").style.display="none";
}

function closeDetails(){
  details.style.display="none";
  document.getElementById("tasks-container").style.display="block";
}

function deleteTask(){
  if(!confirm("Delete this task?")) return;
  tasks = tasks.filter(t=>t.id!==activeTask.id);
  save(); closeDetails(); render();
}

function attachSwipe(row, task){
  let startX=0, currentX=0, moving=false, offset=0;
  const btnWidth=44*3, threshold=btnWidth/2;

  const bg=document.createElement("div"); bg.className="swipe-bg";
  const editBtn=document.createElement("div"); editBtn.className="swipe-btn"; editBtn.textContent="‚úèÔ∏è"; editBtn.style.background="#007AFF";
  const resBtn=document.createElement("div"); resBtn.className="swipe-btn"; resBtn.textContent="üìÖ"; resBtn.style.background="#FF9500";
  const delBtn=document.createElement("div"); delBtn.className="swipe-btn"; delBtn.textContent="üóëÔ∏è"; delBtn.style.background="#FF3B30";
  bg.append(editBtn,resBtn,delBtn);
  row.parentElement.prepend(bg);

  const resetRow=()=>{ row.style.transition="transform 0.2s ease, opacity 0.2s ease"; row.style.transform="translateX(0)"; row.style.opacity=1; setTimeout(()=>row.style.transition="",200); };

  editBtn.onclick=(e)=>{ e.stopPropagation(); openDetails(task.id); resetRow(); };
  resBtn.onclick=(e)=>{ e.stopPropagation(); alert("Reschedule "+task.title); resetRow(); };
  delBtn.onclick=(e)=>{ e.stopPropagation(); tasks=tasks.filter(t=>t.id!==task.id); save(); render(); };

  row.addEventListener("touchstart", e=>{ startX=e.touches[0].clientX; moving=true; });
  row.addEventListener("touchmove", e=>{
    if(!moving) return;
    currentX=e.touches[0].clientX;
    let dx=currentX-startX+offset;
    dx=Math.min(0,dx); dx=Math.max(-btnWidth,dx);
    row.style.transform=`translateX(${dx}px)`;
    row.style.opacity = 1 + dx/btnWidth*0.7; // stronger fade
  });
  row.addEventListener("touchend", e=>{
    moving=false;
    let dx=currentX-startX+offset;
    offset = dx<-threshold?-btnWidth:0;
    row.style.transition="transform 0.2s ease, opacity 0.2s ease";
    row.style.transform=`translateX(${offset}px)`;
    row.style.opacity = offset===0?1:0.3;
    setTimeout(()=>row.style.transition="",200);
  });
}

function render(){
  const tasksDiv=document.getElementById("tasks"); tasksDiv.innerHTML="";
  tasks.forEach(task=>{
    const card=document.createElement("div"); card.className="task";
    const row=document.createElement("div"); row.className="task-row";

    const left=document.createElement("div"); left.className="task-left";
    const c=document.createElement("input"); c.type="checkbox"; c.checked=task.done;
    c.onchange=(e)=>{ task.done=c.checked; save(); render(); e.stopPropagation(); };
    left.append(c);

    const middle=document.createElement("div"); middle.className="task-middle";
    const title=document.createElement("div"); title.className="task-title"; title.textContent=task.title;
    middle.append(title);

    const right=document.createElement("div"); right.className="task-right";
    const dot=document.createElement("div"); dot.className="dot";
    dot.style.background=task.priority===1?"#ff3b30":task.priority===2?"#ff9500":"#ffcc00";
    right.append(dot);

    row.append(left,middle,right);
    card.append(row);
    tasksDiv.append(card);

    attachSwipe(row, task);
  });
}

render();
</script>
</body>
</html>
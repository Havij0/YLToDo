<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Task App v0.9.1</title>

<style>
body {
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#f5f5f7;
}

header {
  padding:14px;
  text-align:center;
  font-weight:600;
}

.version {
  font-size:12px;
  opacity:.5;
}

.tabbar {
  display:flex;
  gap:10px;
  padding:10px;
}

.tab {
  flex:1;
  padding:8px;
  border-radius:12px;
  background:#e5e5ea;
  text-align:center;
}

.tab.active { background:#007aff; color:#fff; }

#taskList { padding:10px; }

.task {
  background:#fff;
  padding:12px;
  border-radius:14px;
  margin-bottom:10px;
  position:relative;
  overflow:hidden;
}

.task.done { opacity:.4; text-decoration:line-through; }

.swipe-bg {
  position:absolute;
  inset:0;
  display:flex;
  justify-content:flex-end;
  gap:10px;
  padding-right:12px;
  align-items:center;
}

.swipe-btn {
  width:38px;
  height:38px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
}

.task-content {
  position:relative;
  background:#fff;
  transition:.25s;
}

#addBar {
  position:fixed;
  bottom:0;
  inset-inline:0;
  background:#fff;
  padding:12px;
  border-top:1px solid #ddd;
  display:flex;
  gap:8px;
  touch-action:none;
}

#addInput { flex:1; padding:8px; border-radius:10px; border:1px solid #ccc; }

#details, #advAdd {
  position:fixed;
  inset:0;
  background:#fff;
  transform:translateX(100%);
  transition:.3s;
  z-index:20;
}

#advAdd { transform:translateY(100%); }

.sheet-header {
  padding:14px;
  display:flex;
  justify-content:space-between;
}

.sheet-body { padding:14px; }

input, textarea {
  width:100%;
  margin-bottom:12px;
  padding:8px;
  border-radius:10px;
  border:1px solid #ccc;
}

/* RESCHEDULE POPUP */
#resOverlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.2);
  display:none;
  z-index:40;
}

#resPopup {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#fff;
  padding:16px;
  width:220px;
  border-radius:16px;
  text-align:center;
}

#resPopup button {
  width:100%;
  padding:8px;
  margin-top:8px;
  border-radius:10px;
}
</style>
</head>

<body>

<header>
  Tasks
  <div class="version">v0.9.1</div>
</header>

<div class="tabbar">
  <div class="tab active" onclick="switchTab('today')">Today</div>
  <div class="tab" onclick="switchTab('unscheduled')">To-Be-Scheduled</div>
</div>

<div id="taskList"></div>

<!-- ADD BAR -->
<div id="addBar">
  <input id="addInput" placeholder="Quick add task‚Ä¶" />
  <button onclick="quickAdd()">Ôºã</button>
</div>

<!-- ADVANCED ADD -->
<div id="advAdd">
  <div class="sheet-header">
    <b>Advanced Task</b>
    <button onclick="closeAdvancedAdd()">‚úï</button>
  </div>
  <div class="sheet-body">
    <input id="advTitle" placeholder="Title" />
    <textarea id="advNotes" placeholder="Notes"></textarea>
    <input id="advDate" type="date" />
    <button onclick="saveAdvanced()">Save</button>
  </div>
</div>

<!-- DETAILS -->
<div id="details">
  <div class="sheet-header">
    <button onclick="closeDetails()">‚Üê</button>
    <b>Task</b>
    <button onclick="toggleEdit()">‚úèÔ∏è</button>
  </div>
  <div class="sheet-body" id="detailsBody"></div>
</div>

<!-- RESCHEDULE -->
<div id="resOverlay" onclick="hideReschedule()">
  <div id="resPopup" onclick="event.stopPropagation()">
    <b>Reschedule</b>
    <button onclick="setReschedule('tomorrow')">Tomorrow</button>
    <input type="date" id="resDate">
    <button onclick="applyReschedule()">Apply</button>
  </div>
</div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks")||"[]");
let tab="today", current=null, resTask=null;

function save(){ localStorage.setItem("tasks",JSON.stringify(tasks)); }

function switchTab(t){
  tab=t;
  document.querySelectorAll(".tab").forEach(el=>el.classList.remove("active"));
  document.querySelectorAll(".tab")[t==="today"?0:1].classList.add("active");
  render();
}

function render(){
  const list=document.getElementById("taskList");
  list.innerHTML="";
  tasks.filter(t=>{
    if(tab==="today") return t.date===today();
    if(tab==="unscheduled") return !t.date;
  }).forEach(t=>{
    const row=document.createElement("div");
    row.className="task"+(t.done?" done":"");
    const bg=document.createElement("div");
    bg.className="swipe-bg";
    bg.innerHTML=`
      <div class="swipe-btn" style="background:#ff9500" onclick="openReschedule(${t.id})">üìÖ</div>
      <div class="swipe-btn" style="background:#ff3b30" onclick="deleteTask(${t.id})">üóë</div>
    `;
    const c=document.createElement("div");
    c.className="task-content";
    c.textContent=t.title;
    c.onclick=()=>openDetails(t.id);
    row.append(bg,c);
    list.append(row);
  });
}

function quickAdd(){
  const v=addInput.value.trim();
  if(!v) return;
  tasks.push({id:Date.now(),title:v,done:false,date:tab==="today"?today():null});
  addInput.value="";
  save(); render();
}

function openDetails(id){
  current=tasks.find(t=>t.id===id);
  details.style.transform="translateX(0)";
  renderDetails();
}

function renderDetails(){
  detailsBody.innerHTML=`
    <h3>${current.title}</h3>
    <p>${current.notes||""}</p>
    <p><b>Date:</b> ${current.date||"To be scheduled"}</p>
    <button onclick="openReschedule(${current.id})">Reschedule</button>
  `;
}

function closeDetails(){ details.style.transform="translateX(100%)"; }

function openAdvancedAdd(){ advAdd.style.transform="translateY(0)"; }
function closeAdvancedAdd(){ advAdd.style.transform="translateY(100%)"; }

function saveAdvanced(){
  tasks.push({
    id:Date.now(),
    title:advTitle.value,
    notes:advNotes.value,
    date:advDate.value||null,
    done:false
  });
  advTitle.value=advNotes.value=advDate.value="";
  closeAdvancedAdd(); save(); render();
}

/* RESCHEDULE */
function openReschedule(id){
  resTask=tasks.find(t=>t.id===id);
  resDate.value=resTask.date||"";
  resOverlay.style.display="block";
}
function hideReschedule(){ resOverlay.style.display="none"; }
function setReschedule(t){
  if(t==="tomorrow"){
    resTask.date=offset(1);
    save(); hideReschedule(); render();
  }
}
function applyReschedule(){
  resTask.date=resDate.value||null;
  save(); hideReschedule(); render();
}

/* HELPERS */
function deleteTask(id){
  tasks=tasks.filter(t=>t.id!==id);
  save(); render();
}
function today(){ return new Date().toISOString().slice(0,10); }
function offset(d){
  const n=new Date(); n.setDate(n.getDate()+d);
  return n.toISOString().slice(0,10);
}

/* ADD BAR PULL UP */
let sy=0;
addBar.addEventListener("touchstart",e=>sy=e.touches[0].clientY);
addBar.addEventListener("touchmove",e=>{
  if(sy-e.touches[0].clientY>60) openAdvancedAdd();
});

/* DETAILS SWIPE BACK */
let dx=0, dy=0;
details.addEventListener("touchstart",e=>{
  dx=e.touches[0].clientX;
  dy=e.touches[0].clientY;
});
details.addEventListener("touchend",e=>{
  if(e.changedTouches[0].clientX-dx>80) closeDetails();
});

render();
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Todo App</title>
<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f2f2f7;
}

.hidden { display: none; }

header {
  padding: 14px 16px;
  font-size: 18px;
  font-weight: 600;
  background: #fff;
  border-bottom: 1px solid #ddd;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

header button {
  font-size: 16px;
  padding: 6px 12px;
  border: none;
  background: none;
  cursor: pointer;
}

#tasks { padding: 12px; padding-bottom: 120px; }

.task {
  margin-bottom: 12px;
  position: relative;
  border-radius:16px;
  overflow:hidden;
}

.task-row {
  display: flex;
  align-items: center;
  min-height:48px;
  padding:0 12px;
  background:#fff;
  position: relative;
  z-index:2; /* row is above buttons */
  transition: transform 0.2s ease;
}

.task-left { width:44px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
.task-middle { flex:1; min-width:0; margin:0 8px; }
.task-right { width:20px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }

.task-row input[type="checkbox"] { width:22px; height:22px; margin:0; }
.task-title { font-size:16px; font-weight:600; cursor:pointer; }
.dot { width:12px; height:12px; border-radius:50%; }

.swipe-bg {
  position:absolute;
  inset:0;
  display:flex;
  justify-content:flex-end;
  align-items:center;
  gap:8px;
  padding:0 8px;
  border-radius:16px;
  z-index:1; /* behind row */
}

.swipe-btn {
  width:52px; height:44px; border-radius:12px;
  display:flex; align-items:center; justify-content:center;
  color:#fff; font-size:18px; flex-shrink:0;
}

#addBar {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: #fff; padding: 12px; display: flex; gap: 8px; border-top: 1px solid #ddd;
}

#addBar input, #addBar select { font-size:16px; padding:14px; border-radius:14px; border:1px solid #ccc; }
#addBar button { padding:14px 18px; font-size:20px; border-radius:14px; border:none; background:#000; color:#fff; }
</style>
</head>
<body>

<div id="today">
  <header><span>Today</span><span></span></header>
  <div id="tasks"></div>
  <div id="addBar">
    <input id="newTitle" placeholder="New taskâ€¦">
    <select id="newPriority">
      <option value="3">Normal</option>
      <option value="2">Important</option>
      <option value="1">Must</option>
    </select>
    <button onclick="addTask()">+</button>
  </div>
</div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks")||"[]");

function save(){ localStorage.setItem("tasks", JSON.stringify(tasks)); }

function addTask(){
  const title = newTitle.value.trim(); if(!title) return;
  tasks.push({id:Date.now(),title,priority:Number(newPriority.value),done:false});
  newTitle.value=""; save(); render();
}

function attachSwipe(row, task){
  let startX=0, currentX=0, moving=false, offset=0;
  const btnWidth=52*3, threshold=btnWidth/2;

  const bg=document.createElement("div"); bg.className="swipe-bg";
  const editBtn=document.createElement("div"); editBtn.className="swipe-btn"; editBtn.textContent="âœï¸"; editBtn.style.background="#007AFF";
  const resBtn=document.createElement("div"); resBtn.className="swipe-btn"; resBtn.textContent="ðŸ“…"; resBtn.style.background="#FF9500";
  const delBtn=document.createElement("div"); delBtn.className="swipe-btn"; delBtn.textContent="ðŸ—‘ï¸"; delBtn.style.background="#FF3B30";
  bg.append(editBtn,resBtn,delBtn); row.parentElement.prepend(bg);

  const resetRow=()=>{ row.style.transition="transform 0.2s"; row.style.transform=""; setTimeout(()=>row.style.transition="",200); };

  editBtn.onclick=(e)=>{ e.stopPropagation(); alert("Edit "+task.title); resetRow(); };
  resBtn.onclick=(e)=>{ e.stopPropagation(); alert("Reschedule "+task.title); resetRow(); };
  delBtn.onclick=(e)=>{ e.stopPropagation(); tasks=tasks.filter(t=>t.id!==task.id); save(); render(); };

  row.addEventListener("touchstart", e=>{ startX=e.touches[0].clientX; moving=true; });
  row.addEventListener("touchmove", e=>{
    if(!moving) return;
    currentX=e.touches[0].clientX;
    let dx=currentX-startX+offset;
    dx=Math.min(0,dx); // only left swipe
    dx=Math.max(-btnWidth,dx);
    row.style.transform=`translateX(${dx}px)`;
  });
  row.addEventListener("touchend", e=>{
    moving=false;
    let dx=currentX-startX+offset;
    offset = dx<-threshold?-btnWidth:0;
    row.style.transition="transform 0.2s";
    row.style.transform=`translateX(${offset}px)`;
    setTimeout(()=>row.style.transition="",200);
  });
}

function render(){
  const tasksDiv=document.getElementById("tasks"); tasksDiv.innerHTML="";
  tasks.forEach(task=>{
    const card=document.createElement("div"); card.className="task";
    const row=document.createElement("div"); row.className="task-row";

    const left=document.createElement("div"); left.className="task-left";
    const c=document.createElement("input"); c.type="checkbox"; c.checked=task.done;
    c.onchange=(e)=>{ task.done=c.checked; save(); render(); e.stopPropagation(); };
    left.append(c);

    const middle=document.createElement("div"); middle.className="task-middle";
    const title=document.createElement("div"); title.className="task-title"; title.textContent=task.title;
    middle.append(title);

    const right=document.createElement("div"); right.className="task-right";
    const dot=document.createElement("div"); dot.className="dot";
    dot.style.background=task.priority===1?"#ff3b30":task.priority===2?"#ff9500":"#ffcc00";
    right.append(dot);

    row.append(left,middle,right);
    card.append(row);
    tasksDiv.append(card);

    attachSwipe(row, task);
  });
}

render();
</script>
</body>
</html>

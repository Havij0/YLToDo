<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Todo App â€“ v0.9.1</title>

<style>
* { box-sizing: border-box; }
body { margin: 0; font-family: -apple-system, BlinkSystemFont, "SF Pro Text", sans-serif; background: #f2f2f7; }
.hidden { display: none; }

/* HEADER */
header {
  position: fixed; top: 0; left: 0; right: 0;
  height: 56px;
  background: #fff;
  border-bottom: 1px solid #ddd;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 16px;
  z-index: 20;
}
header .title { font-size: 20px; font-weight: 700; }
header .version { font-size: 12px; color: #888; }

/* TAB BAR */
#tabBar {
  position: fixed; top: 56px; left: 0; right: 0;
  height: 44px;
  display: flex;
  background: #fff;
  border-bottom: 1px solid #ddd;
  z-index: 20;
}
.tab {
  flex: 1;
  text-align: center;
  line-height: 44px;
  cursor: pointer;
  font-weight: 600;
  color: #666;
}
.tab.active { color: #000; border-bottom: 2px solid #000; }

/* CONTENT */
#content { padding-top: 102px; padding-bottom: 120px; overflow-y: auto; }

/* DATE GROUP (AGENDA) */
.date-group {
  margin: 18px 12px 6px;
  font-size: 14px;
  font-weight: 700;
  color: #555;
}

/* TASK */
.task { background: #fff; margin: 8px 12px; border-radius: 16px; overflow: hidden; position: relative; }
.task.done { opacity: 0.45; }
.task-row { display: flex; align-items: center; min-height: 52px; padding: 0 14px; background: #fff; position: relative; z-index: 2; transition: transform 0.25s ease; touch-action: pan-y; }
.task-left { width: 36px; }
.task-middle { flex: 1; min-width: 0; }
.task-right { width: 20px; }
.task-title { font-size: 16px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: pointer; }
.dot { width: 10px; height: 10px; border-radius: 50%; }

/* SWIPE */
.swipe-bg { position: absolute; inset: 0; display: flex; justify-content: flex-end; align-items: center; padding-right: 10px; background: #f2f2f7; z-index: 1; }
.swipe-btn { width: 44px; height: 44px; border-radius: 14px; display: flex; align-items: center; justify-content: center; margin-left: 8px; color: #fff; font-size: 18px; }

/* ADD BAR */
#addBar { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; border-top: 1px solid #ddd; padding: 10px 12px; display: flex; gap: 8px; z-index: 20; }
#addBar input, #addBar select { flex: 1; font-size: 16px; padding: 12px; border-radius: 14px; border: 1px solid #ccc; }
#addBar button { padding: 0 18px; font-size: 22px; border-radius: 14px; border: none; background: #000; color: #fff; }

/* DETAILS */
#details { position: fixed; inset: 0; background: #f2f2f7; z-index: 50; overflow-y: auto; }
#details .spacer { height: 72px; }
.section { background: #fff; margin: 12px; padding: 12px 16px; border-radius: 16px; }
.section h3 { margin: 0 0 8px; font-size: 13px; color: #666; }
.read { font-size: 16px; }
input, textarea, select { width: 100%; font-size: 16px; padding: 10px; border-radius: 12px; border: 1px solid #ccc; }
input[type="date"] { height: 40px; padding: 8px; }
textarea { resize: none; }

/* SUBTASK */
.subtask { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.subtask input { width: 20px; height: 20px; }
.subtask .text { flex: 1; }
#deleteBtn { margin: 16px 12px; padding: 14px; font-size: 16px; border-radius: 16px; background: #ff3b30; color: #fff; border: none; }
.timestamps { margin: 0 12px 24px; font-size: 12px; color: #888; }
</style>
</head>

<body>

<header>
  <div class="title">Todo App</div>
  <div class="version">v0.9.1</div>
</header>

<div id="tabBar">
  <div class="tab active" data-tab="today">Today</div>
  <div class="tab" data-tab="unscheduled">To Be Scheduled</div>
  <div class="tab" data-tab="agenda">Agenda</div>
</div>

<div id="content">
  <div id="tasks"></div>
</div>

<div id="addBar">
  <input id="newTitle" placeholder="New taskâ€¦" />
  <select id="newPriority">
    <option value="3">Normal</option>
    <option value="2">Important</option>
    <option value="1">Must</option>
  </select>
  <button onclick="addTask()">+</button>
</div>

<script>
// ===============================
// CORE STATE
// ===============================
const tasksDiv = document.getElementById("tasks");
const tabs = document.querySelectorAll(".tab");

let tasks = JSON.parse(localStorage.getItem("tasks_v064") || "[]");
let currentTab = "today";
const todayStr = new Date().toISOString().slice(0,10);
const SWIPE_WIDTH = 160;

// ===============================
// TAB SWITCH
// ===============================
tabs.forEach(tab=>{
  tab.onclick = () => {
    currentTab = tab.dataset.tab;
    tabs.forEach(t=>t.classList.remove("active"));
    tab.classList.add("active");
    render();
  };
});

// ===============================
// SAVE
// ===============================
function save() {
  localStorage.setItem("tasks_v064", JSON.stringify(tasks));
}

// ===============================
// QUICK ADD
// ===============================
function addTask() {
  const title = document.getElementById("newTitle").value.trim();
  if (!title) return;

  const now = Date.now();
  tasks.push({
    id: now,
    title,
    desc: "",
    priority: 3,
    done: false,
    subtasks: [],
    scheduled: currentTab === "today" ? todayStr : "",
    created: now,
    edited: now
  });

  document.getElementById("newTitle").value = "";
  save();
  render();
}

// ===============================
// RENDER
// ===============================
function render() {
  tasksDiv.innerHTML = "";

  if (currentTab === "agenda") {
    renderAgenda();
    return;
  }

  tasks.filter(t => {
    if (currentTab === "today") return t.scheduled === todayStr;
    if (currentTab === "unscheduled") return !t.scheduled;
  }).forEach(renderTask);
}

// ===============================
// AGENDA RENDER
// ===============================
function renderAgenda() {
  const dated = tasks
    .filter(t => t.scheduled)
    .sort((a,b) => a.scheduled.localeCompare(b.scheduled));

  let currentDate = "";

  dated.forEach(task => {
    if (task.scheduled !== currentDate) {
      currentDate = task.scheduled;
      const label = document.createElement("div");
      label.className = "date-group";
      label.textContent =
        task.scheduled === todayStr
          ? "Today"
          : new Date(task.scheduled).toLocaleDateString(undefined, {
              weekday: "long",
              day: "numeric",
              month: "long"
            });
      tasksDiv.appendChild(label);
    }
    renderTask(task);
  });
}

// ===============================
// TASK CARD
// ===============================
function renderTask(task) {
  const card = document.createElement("div");
  card.className = "task" + (task.done ? " done" : "");

  const bg = document.createElement("div");
  bg.className = "swipe-bg";
  bg.append(
    swipeBtn("ðŸ—‘", "#ff3b30", () => {
      tasks = tasks.filter(t => t.id !== task.id);
      save();
      render();
    })
  );

  const row = document.createElement("div");
  row.className = "task-row";

  let startX = 0, dx = 0;
  row.ontouchstart = e => startX = e.touches[0].clientX;
  row.ontouchmove = e => {
    dx = e.touches[0].clientX - startX;
    if (dx < 0) row.style.transform = `translateX(${dx}px)`;
  };
  row.ontouchend = () => {
    row.style.transform = dx < -80 ? `translateX(-${SWIPE_WIDTH}px)` : "translateX(0)";
    dx = 0;
  };

  const left = document.createElement("div");
  left.className = "task-left";
  const cb = document.createElement("input");
  cb.type = "checkbox";
  cb.checked = task.done;
  cb.onchange = () => {
    task.done = cb.checked;
    save();
    render();
  };
  left.appendChild(cb);

  const mid = document.createElement("div");
  mid.className = "task-middle";
  const title = document.createElement("div");
  title.className = "task-title";
  title.textContent = task.title;
  mid.appendChild(title);

  const right = document.createElement("div");
  right.className = "task-right";
  const dot = document.createElement("div");
  dot.className = "dot";
  dot.style.background =
    task.priority === 1 ? "#ff3b30" :
    task.priority === 2 ? "#ff9500" : "#34c759";
  right.appendChild(dot);

  row.append(left, mid, right);
  card.append(bg, row);
  tasksDiv.appendChild(card);
}

// ===============================
function swipeBtn(icon, color, fn) {
  const b = document.createElement("div");
  b.className = "swipe-btn";
  b.textContent = icon;
  b.style.background = color;
  b.onclick = fn;
  return b;
}

render();
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Full To-Do App</title>
<style>
html, body { height:100%; margin:0; font-family:-apple-system,BlinkMacSystemFont,sans-serif; background:#f2f2f7; }
body { display:flex; flex-direction:column; }

header { flex-shrink:0; padding:16px; font-size:20px; font-weight:600; background:#fff; border-bottom:1px solid #e5e5ea; }

.tasks-wrapper { flex:1; overflow:hidden; }
#tasks { height:100%; overflow-y:auto; padding:12px; overscroll-behavior:contain; }

.task { margin-bottom:10px; }
.task-row { position:relative; height:64px; background:#fff; border-radius:12px; overflow:hidden; }
.task-actions { position:absolute; right:0; top:0; height:100%; display:flex; align-items:center; gap:14px; padding-right:16px; background:#f2f2f7; }
.action { width:40px; height:40px; border-radius:10px; border:none; font-size:18px; display:flex; align-items:center; justify-content:center; color:white; }
.action.edit { background:#007AFF; }
.action.schedule { background:#FF9500; }
.action.delete { background:#FF3B30; }
.task-content { position:relative; z-index:2; height:100%; display:flex; align-items:center; gap:12px; padding:0 16px; background:#fff; transition:transform 0.25s ease, opacity 0.25s ease; cursor:pointer; }
.task-content input { width:22px; height:22px; }
.task-title { flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-size:16px; }
.priority { width:14px; height:14px; border-radius:50%; background:#ffcc00; }

.add-bar { flex-shrink:0; height:64px; display:flex; align-items:center; gap:8px; padding:0 12px; background:#fff; border-top:1px solid #e5e5ea; }
.add-bar input { flex:1; height:40px; border-radius:10px; border:1px solid #ccc; padding:0 12px; font-size:16px; }
.add-bar button { width:44px; height:44px; border-radius:12px; border:none; font-size:22px; background:#000; color:#fff; cursor:pointer; }

/* TASK PAGE */
#taskPage { position:fixed; top:0; left:0; right:0; bottom:0; background:#f2f2f7; display:none; flex-direction:column; z-index:100; }
#taskPage header { display:flex; justify-content:space-between; align-items:center; padding:16px; font-size:20px; background:#fff; border-bottom:1px solid #e5e5ea; }
#taskPage .content { flex:1; padding:16px; overflow-y:auto; display:flex; flex-direction:column; gap:12px; }
#taskPage .title-edit { font-size:20px; padding:6px 8px; border:1px solid #ccc; border-radius:8px; display:none; }
#taskPage .description-edit { font-size:16px; padding:6px 8px; border:1px solid #ccc; border-radius:8px; display:none; min-height:60px; }
#taskPage .title-view { font-size:20px; font-weight:600; }
#taskPage .description-view { font-size:16px; color:#555; min-height:60px; }
#taskPage .subtasks { display:flex; flex-direction:column; gap:8px; margin-top:8px; }
.subtask-row { display:flex; gap:8px; align-items:center; }
.subtask-row input { flex:1; height:36px; border-radius:6px; border:1px solid #ccc; padding:0 8px; font-size:16px; }
.subtask-row button { width:32px; height:32px; border:none; border-radius:6px; background:#FF3B30; color:white; font-size:18px; cursor:pointer; display:none; }
#taskPage .timestamps { font-size:12px; color:#555; margin-top:4px; }
#taskPage #editBtn { padding:6px 12px; background:#007AFF; color:white; border:none; border-radius:8px; cursor:pointer; }
#taskPage #deleteTaskBtn { padding:6px 12px; background:#FF3B30; color:white; border:none; border-radius:8px; cursor:pointer; width:100%; margin-top:8px; display:none; }

</style>
</head>
<body>

<header>Today</header>

<div class="tasks-wrapper">
  <div id="tasks"></div>
</div>

<div class="add-bar">
  <input id="newTask" placeholder="Add a task‚Ä¶" autocorrect="off" autocomplete="off">
  <button onclick="addTask()">+</button>
</div>

<!-- TASK PAGE -->
<div id="taskPage">
  <header>
    <button id="backBtn">&larr;</button>
    <span>Task</span>
    <button id="editToggleBtn">Edit</button>
  </header>
  <div class="content">
    <input id="taskTitleEdit" class="title-edit" autocorrect="off" autocomplete="off">
    <div id="taskTitleView" class="title-view"></div>
    <textarea id="taskDescriptionEdit" class="description-edit" placeholder="Add a description"></textarea>
    <div id="taskDescriptionView" class="description-view"></div>
    <div class="subtasks" id="taskSubtasks"></div>
    <div class="timestamps" id="taskTimestamps"></div>
    <button id="deleteTaskBtn">Delete Task</button>
  </div>
</div>

<script>
let tasks = [
  {id:1,title:"Buy groceries",description:"Milk, Eggs, Bread",subtasks:[{title:"Buy milk",done:false}],created:Date.now(),updated:Date.now()},
  {id:2,title:"Finish project presentation",description:"Prepare slides and notes",subtasks:[],created:Date.now(),updated:Date.now()},
  {id:3,title:"Go to the gym",description:"Leg day",subtasks:[],created:Date.now(),updated:Date.now()}
];

const ACTION_WIDTH=160;
let currentTask=null;
let editMode=false;

/* ---------- RENDER TASK LIST ---------- */
function render(){
  const list=document.getElementById("tasks");
  list.innerHTML="";
  tasks.forEach(task=>{
    const wrapper=document.createElement("div"); wrapper.className="task";
    const row=document.createElement("div"); row.className="task-row";

    const actions=document.createElement("div"); actions.className="task-actions";
    actions.innerHTML=`<button class="action edit">‚úèÔ∏è</button>
                       <button class="action schedule">üìÖ</button>
                       <button class="action delete">üóëÔ∏è</button>`;

    const content=document.createElement("div"); content.className="task-content";
    content.innerHTML=`<input type="checkbox"${task.done?' checked':''}><div class="task-title">${task.title}</div><div class="priority"></div>`;

    row.append(actions,content); wrapper.append(row); list.append(wrapper);

    attachSwipe(row,content);
    // Clicking task opens task page
    content.addEventListener("click",()=>{ openTaskPage(task); });
  });
}

/* ---------- SWIPE LOGIC ---------- */
function attachSwipe(row,content){
  let startX=0,currentX=0,offset=0,dragging=false;
  row.addEventListener("touchstart",e=>{startX=e.touches[0].clientX;dragging=true;});
  row.addEventListener("touchmove",e=>{
    if(!dragging) return;
    currentX=e.touches[0].clientX;
    let dx=currentX-startX+offset;
    dx=Math.min(0,Math.max(-ACTION_WIDTH,dx));
    content.style.transform=`translateX(${dx}px)`;
    content.style.opacity=1+dx/ACTION_WIDTH*0.4;
  });
  row.addEventListener("touchend",()=>{
    dragging=false;
    const open=currentX-startX<-ACTION_WIDTH/2;
    offset=open?-ACTION_WIDTH:0;
    content.style.transform=`translateX(${offset}px)`;
    content.style.opacity=offset?0.6:1;
  });
}

/* ---------- ADD TASK ---------- */
function addTask(){
  const input=document.getElementById("newTask");
  const title=input.value.trim(); if(!title) return;
  tasks.push({id:Date.now(),title,description:"",subtasks:[],created:Date.now(),updated:Date.now()});
  input.value=""; render();
}

/* ---------- TASK PAGE ---------- */
const taskPage=document.getElementById("taskPage");
const backBtn=document.getElementById("backBtn");
const editToggleBtn=document.getElementById("editToggleBtn");
const taskTitleEdit=document.getElementById("taskTitleEdit");
const taskTitleView=document.getElementById("taskTitleView");
const taskDescriptionEdit=document.getElementById("taskDescriptionEdit");
const taskDescriptionView=document.getElementById("taskDescriptionView");
const taskSubtasks=document.getElementById("taskSubtasks");
const taskTimestamps=document.getElementById("taskTimestamps");
const deleteTaskBtn=document.getElementById("deleteTaskBtn");

function openTaskPage(task){
  currentTask=task;
  editMode=false;
  renderTaskPage();
  taskPage.style.display="flex";
}

function renderTaskPage(){
  if(!currentTask) return;
  // Title & description
  taskTitleView.style.display=editMode?"none":"block";
  taskTitleEdit.style.display=editMode?"block":"none";
  taskTitleView.textContent=currentTask.title;
  taskTitleEdit.value=currentTask.title;

  taskDescriptionView.style.display=editMode?"none":"block";
  taskDescriptionEdit.style.display=editMode?"block":"none";
  taskDescriptionView.textContent=currentTask.description;
  taskDescriptionEdit.value=currentTask.description;

  // Subtasks
  taskSubtasks.innerHTML="";
  currentTask.subtasks.forEach((st,i)=>{
    const row=document.createElement("div"); row.className="subtask-row";
    const input=document.createElement("input"); input.value=st.title; input.disabled=!editMode;
    input.addEventListener("input",()=>{st.title=input.value; currentTask.updated=Date.now(); renderTaskPage();});
    const delBtn=document.createElement("button"); delBtn.textContent="√ó"; delBtn.style.display=editMode?"block":"none";
    delBtn.addEventListener("click",()=>{currentTask.subtasks.splice(i,1); currentTask.updated=Date.now(); renderTaskPage();});
    row.append(input,delBtn); taskSubtasks.append(row);
  });

  if(editMode){
    const addBtn=document.createElement("button"); addBtn.textContent="+ Add Subtask";
    addBtn.style.marginTop="8px"; addBtn.addEventListener("click",()=>{
      const newSub={title:"",done:false}; currentTask.subtasks.push(newSub); currentTask.updated=Date.now(); renderTaskPage();
      setTimeout(()=>{focusLastSubtask();},50);
    });
    taskSubtasks.append(addBtn);
  }

  const created=new Date(currentTask.created).toLocaleString();
  const updated=new Date(currentTask.updated).toLocaleString();
  taskTimestamps.textContent=`Created: ${created} | Last edit: ${updated}`;

  editToggleBtn.textContent=editMode?"Save":"Edit";
  deleteTaskBtn.style.display=editMode?"block":"none";
}

editToggleBtn.addEventListener("click",()=>{
  if(editMode){
    currentTask.title=taskTitleEdit.value;
    currentTask.description=taskDescriptionEdit.value;
    currentTask.updated=Date.now();
    editMode=false;
  } else { editMode=true; }
  renderTaskPage(); render();
});

deleteTaskBtn.addEventListener("click",()=>{
  if(!currentTask) return;
  tasks=tasks.filter(t=>t.id!==currentTask.id);
  currentTask=null; taskPage.style.display="none"; render();
});

backBtn.addEventListener("click",()=>{taskPage.style.display="none";});

/* Focus helper */
function focusLastSubtask(){
  const inputs=taskSubtasks.querySelectorAll("input");
  if(inputs.length) inputs[inputs.length-1].focus();
}

render();
</script>

</body>
</html>